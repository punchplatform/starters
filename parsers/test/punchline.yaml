---
apiVersion: punchline.punchplatform.io/v2
kind: StreamPunchline
metadata:
  name: punch-parsers
spec:
  containers:
    applicationContainer:
      image: ghcr.io/punchplatform/punchline-java:8.0-dev
    resourcesInitContainer:
      image: ghcr.io/punchplatform/resourcectl:8.0-dev
      resourcesProviderUrl: http://artifacts-server.punch-artifacts:4245
  dependencies:
    - punch-parsers:io.github.starter:parsers:1.0.0
  dag:
    - id: input
      kind: source
      type: generator
      settings:
        messages:
          - color=red city=Paris uri=https://punchplatform.com
          - color=green city=Rome uri=https://punchplatform.com
          - color=yellow city=New York uri=https://punchplatform.com
          - color=black city=London uri=https://punchplatform.com
      out:
        - id: parser
          table: logs
          columns:
            - name: data
              type: string

    - id: parser
      kind: function
      type: punchlet
      settings:
        resources:
          - name: color_codes
            format: json
            type: file
            url: sample/resources/color_codes.json
          - name: custom_groks
            type: file
            format: grok
            url: sample/groks
        punchlets:
          - sample/parser.punch
      out:
        - id: output
          table: logs
          columns:
            - name: log
              type: string

    - id: output
      kind: sink
      type: show
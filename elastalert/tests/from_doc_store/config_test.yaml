---
apiVersion: punchline.punchplatform.io/v2
kind: StreamApplication
metadata:
  name: elastalert-v2-basic
  labels:
    alerter: basic
spec:
  dependencies:
    - additional-pex:io.github.starter:elastalert-modules:1.0.0
  containers:
    serviceAccount: admin-user
    resourcesInitContainer:
      image: ghcr.io/punchplatform/resourcectl:8.0-dev
      resourcesProviderUrl: http://artifacts-server.punch-artifacts:4245
    applicationContainer:
      image: ghcr.io/punchplatform/punch-elastalert:8.0-dev
      imagePullPolicy: IfNotPresent
      replicas: 1
      args: ["example/config.yaml", "--start", "2020-09-23T23:59:59.448Z"]
      configMapMounts:
        - name: elastalert
          mountPath: /example/
          content:
            config.yaml: |
              es_host: punchplatform-es-default.doc-store
              es_port: 9200
              es_username: elastic
              es_password: elastic
              writeback_index: elastalert
              
              run_every:
                minutes: 2
              buffer_time:
                minutes: 3600
              rules_loader: "elastalert_core.rule_loader.elasticsearch_loader.ElasticsearchLoader"
              rules_index: rules
              rules_hosts: ["elastic:elastic@punchplatform-es-default.doc-store:9200"]

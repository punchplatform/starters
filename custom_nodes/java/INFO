#!/usr/bin/env bash -ec -o pipefail

###
# User Configuration
###

# Information used to generate metadata.yml
GROUP_ID ?= io.github.punchplatform
ARTIFACT_ID ?= punchline-java-starter-kit
VERSION ?= 1.0.0
TIMESTAMP = $(shell date +%s)

# Input and Generated files
OUTPUT_DIR = $(shell pwd)/target
METADATA_TEMPLATE_FILE = $(shell pwd)/metadata/metadata.yml
OUTPUT_JAR_ARCHIVE = ${OUTPUT_DIR}/${ARTIFACT_ID}-${VERSION}-jar-with-dependencies.jar
OUTPUT_METADATA_YML = ${OUTPUT_DIR}/metadata.yml
OUTPUT_ARCHIVE = ${OUTPUT_DIR}/${ARTIFACT_ID}-${VERSION}.zip

# Set python version
# for example can be changed to: 3.9.7-slim-buster
JAVA_VERSION_TAG ?= "jdk-11.0.14.1_1-alpine"
MAVEN_LOCAL_REPOSITORY ?= "${HOME}"/.m2/repository

# used to build jar (should not be changed)
SOURCES = src
NAME ?= ${ARTIFACT_ID}-${VERSION}

# Tutorial
PUNCHLINE ?= $(shell pwd)/punchline.yaml
ARTIFACT_SERVER_UPLOAD_URL ?= http://artifacts-server.kooker:4245/v1/artifacts/upload

###
# Images
###

ENGINE_IMG ?= ghcr.io/punchplatform/punchline-java:8.0-dev
TOOL_IMG = tool
JAR_IMG = javaworker

###
# internal
###

CONTAINER_NAME ?= package_worker
MVN = $(shell pwd)/mvnw

###
# Makefile Configuration
###

.DEFAULT_GOAL := docker-build
BUILDKIT_PROGRESS ?= plain
DOCKER_BUILDKIT = 1
